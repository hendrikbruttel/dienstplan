:root{
  --border: #ddd;
  --text: #333;
  --muted: #374151;
  --row-even: #f3f4f6;
  --hdr: #f2f2f2;
  --hdr-true: #f7f7f7;
  --hdr-false: #e5e7eb;

  --green: #16a34a; --green-text:#ffffff;
  --red: #dc2626; --red-text:#ffffff;
  --blue: #2563eb; --blue-text:#ffffff;
  --gray: #e5e7eb; --gray-text:#2563eb;
  --darkg: #9ca3af; --darkg-text:#ffffff;
  --black: #111827; --black-text:#ffffff;
  --yellow: #facc15; --yellow-text:#111827;

  --date-col-width: 50px;
  --person-col-width: 120px;
  --sum-col-width: 60px;

  --date-cols: 7;

  --hdr-row1-h: 32px;
}
* { box-sizing: border-box; }
html, body { height:100%; }
body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color:var(--text); }

.wrap { padding: 10px; display:flex; flex-direction:column; gap:8px; height:100vh; position: relative; }
.toolbar { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
.label { font-size:13px; color:#555; }
select { padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:#fff; }

.matrix-scroller { position:relative; flex:1 1 auto; overflow:auto; border:1px solid var(--border); border-radius:10px; background:white; }

/* --- FINALE LÖSUNG FÜR STICKY BORDERS: NEUES BORDER-MODELL --- */
table.matrix {
  /* GEÄNDERT: border-collapse: separate ist die robusteste Methode */
  border-collapse: separate;
  border-spacing: 0;
  border-top: 1px solid var(--border);
  border-left: 1px solid var(--border);
  width: max(100%, calc(var(--person-col-width) + (var(--date-cols) * var(--date-col-width)) + (3 * var(--sum-col-width))));
  table-layout: auto;
}

.th, .td {
  /* GEÄNDERT: Jede Zelle zeichnet nur noch ihren rechten und unteren Rand */
  padding:8px;
  text-align:center;
  position: relative;
  background:#fff;
  border-right: 1px solid var(--border);
  border-bottom: 1px solid var(--border);
  border-left: none;
  border-top: none;
}
/* --- ENDE NEUES BORDER-MODELL --- */

.th { background-color: var(--hdr); color: var(--text); font-weight:600; }
.td.bold { font-weight:700; }

thead tr:nth-child(1) th {
  position: sticky; top: 0; z-index: 20;
  background-color: var(--hdr);
}
thead tr:nth-child(2) th {
  position: sticky; top: var(--hdr-row1-h); z-index: 19;
  background-color: var(--hdr);
}
thead .col-person,
thead .col-sum {
  background-color: var(--hdr) !important;
}

.tr.even .td:not([data-colored="1"]) { background-color: var(--row-even); }
.tr.odd  .td:not([data-colored="1"]) { background-color: #fff; }

.col-person {
  min-width: var(--person-col-width);
  position: sticky; left: 0; z-index: 11;
  background-color: #fff; background-clip: padding-box;
}
thead .col-person { z-index: 21; }

.col-date { min-width: var(--date-col-width); }

.col-sum {
  min-width: var(--sum-col-width);
  position: sticky;
  background-color: #fff; background-clip: padding-box;
  /* Jede Summenspalte braucht jetzt einen expliziten linken Rand */
  border-left: 1px solid var(--border);
}

/* z-index Hierarchie ist weiterhin gut für die Stapelung */
.col-sum-right { right: 0; z-index: 11; }
.col-sum-middle { right: var(--sum-col-width); z-index: 12; }
.col-sum-left { right: calc(2 * var(--sum-col-width)); z-index: 13; }

thead .col-sum-right { z-index: 21; }
thead .col-sum-middle { z-index: 22; }
thead .col-sum-left { z-index: 23; }

tbody .tr.even .col-person:not([data-colored="1"]),
tbody .tr.even .col-sum:not([data-colored="1"]) { background-color: var(--row-even); }

.team-sep .td {
  /* Wichtig, damit die dicke Linie gezeichnet wird */
  border-top: 3px solid #111827 !important;
}

.c-blue{ background:var(--blue) !important; color:var(--blue-text); font-weight:700; }
.c-gray{ background:var(--gray) !important; color:var(--gray-text); font-weight:700; }
.c-darkg{ background:var(--darkg) !important; color:var(--darkg-text); font-weight:700; }
.c-black{ background:var(--black) !important; color:var(--black-text); font-weight:700; }
.c-green{ background:var(--green) !important; color:var(--green-text); font-weight:700; }
.c-yellow{ background:var(--yellow) !important; color:var(--yellow-text); font-weight:700; }
.c-red{ background:var(--red) !important; color:var(--red-text); font-weight:700; }
.pat-white-red{ background-image: repeating-linear-gradient(45deg, #ffffff 0, #ffffff 8px, var(--red) 8px, var(--red) 16px) !important; }
.pat-green-red{ background-image: repeating-linear-gradient(45deg, var(--green) 0, var(--green) 8px, var(--red) 8px, var(--red) 16px) !important; color:#fff; font-weight:700; }
.pat-yellow-red{ background-image: repeating-linear-gradient(45deg, var(--yellow) 0, var(--yellow) 8px, var(--red) 8px, var(--red) 16px) !important; color:#111827; font-weight:700; }

.legend { margin-top:8px; font-size:12px; color:var(--muted); line-height:1.4; display:flex; flex-wrap:wrap; gap:8px 16px; }
.legend .item { display:inline-flex; align-items:center; gap:6px; white-space:nowrap; }
.legend .swatch { display:inline-block; width:14px; height:14px; border:1px solid #9ca3af; }

.popover { position: fixed; z-index: 1000; background:#fff; border:1px solid var(--border); border-radius:10px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); min-width: 280px; overflow:hidden; outline:none; }
.popover h4 { margin:0; padding:10px 12px; font-size:14px; border-bottom:1px solid var(--border); background:#fafafa; }
.popover .opt { padding:10px 12px; cursor:pointer; }
.popover .opt:hover { background:#f5f5f5; }
.popover .empty { padding:12px; color:#666; }
.popover .sep { margin:0; border:0; border-top:1px solid var(--border); }

tbody .tr { content-visibility: auto; contain-intrinsic-size: 36px 800px; }

.toast { position:fixed; bottom:12px; right:12px; padding:10px 12px; border:1px solid var(--border); border-radius:8px; background:#fff; box-shadow:0 6px 20px rgba(0,0,0,.12); z-index:2000; }
.loader { position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(255,255,255,0.8); z-index:3000; display:flex; align-items:center; justify-content:center; font-weight:600; color:var(--muted); backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(2px); transition: opacity .2s; }
.loader.hidden { opacity:0; pointer-events:none; }
.empty-state { padding: 40px 20px; text-align: center; color: var(--muted); }